# 日本株価予測アプリ 仕様書

## 1. プロジェクト概要

### 1.1 アプリ名
**Kabu Predict** — 日本株 AI 予測ツール

### 1.2 目的
ブラウザ上で機械学習（LSTM）を用いて日本株の短期株価予測を行い、チャートで可視化するWebアプリケーション。GitHub Pages でホスティングし、静的サイトとして動作する。

### 1.3 ポジショニング
- **学習・デモ用途**のアプリケーション（実際の投資判断に使用することは推奨しない）
- ブラウザ完結型：サーバーサイド不要
- 無料で利用可能

---

## 2. 技術スタック

| カテゴリ | 技術 | バージョン/備考 |
|----------|------|----------------|
| ビルドツール | Vite | 高速な開発サーバー・ビルド |
| フレームワーク | React | コンポーネント分割構成 |
| 機械学習 | TensorFlow.js | ブラウザ上で LSTM モデルを学習・推論 |
| 株価データ | Yahoo Finance API | 非公式API、CORSプロキシ経由 |
| チャート | Recharts | React 対応のチャートライブラリ |
| スタイリング | Tailwind CSS | PostCSS 経由で本番ビルド |
| ホスティング | GitHub Pages | ビルド成果物をデプロイ |

---

## 3. 機能要件

### 3.1 データ取得機能

| 項目 | 詳細 |
|------|------|
| データソース | Yahoo Finance API（Chart エンドポイント、非公式） |
| CORS対策 | allorigins.win プロキシ経由 |
| 対象市場 | 東京証券取引所（取引所コード: `T`） |
| シンボル形式 | `{証券コード}.T`（例: `7203.T` = トヨタ） |
| データ種別 | 日足 OHLCV（始値・高値・安値・終値・出来高） |
| 取得期間 | 過去約1年分 |
| 認証 | 不要（APIキーなし） |

**API リクエスト例:**
```
GET https://query1.finance.yahoo.com/v8/finance/chart/7203.T
  ?range=1y
  &interval=1d
```

> ※ ブラウザからのアクセスはCORS制限があるため、allorigins.win プロキシ経由でリクエストする。

### 3.2 銘柄検索機能

| 項目 | 詳細 |
|------|------|
| 検索方法 | 証券コードの直接入力（例: `7203`） |
| バリデーション | 存在しないコードの場合はエラー表示 |

### 3.3 機械学習予測機能

#### モデル概要

| 項目 | 詳細 |
|------|------|
| アルゴリズム | LSTM（Long Short-Term Memory） |
| ライブラリ | TensorFlow.js |
| 実行環境 | ブラウザ上（WebGL バックエンド） |
| 学習データ | 取得した過去の株価データ（終値ベース） |

#### データ前処理

1. **正規化**: Min-Max スケーリング（0〜1の範囲に変換）
2. **ウィンドウ作成**: 過去 N 日分のデータを入力、翌日の終値を出力とするスライディングウィンドウ
3. **訓練/テスト分割**: 80% を訓練データ、20% をテストデータ

#### モデルアーキテクチャ

```
入力層:     [バッチサイズ, ウィンドウサイズ, 特徴量数]
LSTM層1:    50ユニット（return_sequences: true）
Dropout層:  0.2
LSTM層2:    50ユニット
Dropout層:  0.2
Dense層:    1ユニット（出力: 翌日の予測終値）
```

#### ハイパーパラメータ（デフォルト値 / ユーザー調整可能）

| パラメータ | デフォルト値 | 調整範囲 | 説明 |
|-----------|------------|---------|------|
| ウィンドウサイズ | 30 | 10〜60 | 入力に使う過去日数 |
| エポック数 | 50 | 10〜200 | 学習の反復回数 |
| 学習率 | 0.001 | 0.0001〜0.01 | オプティマイザの学習率 |
| バッチサイズ | 32 | 16〜64 | ミニバッチのサイズ |

#### 予測方式（逐次生成）

複数日先の予測は **逐次生成方式（Recursive / Multi-step Forecasting）** で行う。

```
1日目の予測: 過去 N 日分の実データ → モデル → 予測値₁
2日目の予測: 過去 N-1 日分の実データ + 予測値₁ → モデル → 予測値₂
3日目の予測: 過去 N-2 日分の実データ + 予測値₁₂ → モデル → 予測値₃
  ...（以降同様）
```

> **⚠ 誤差累積に関する注意**: 逐次生成方式では、先の予測値を次の入力として使用するため、予測日数が増えるほど誤差が累積し精度が低下する傾向がある。特に3営業日以降の予測は参考値程度として扱うことを推奨する。

#### 予測出力

| 項目 | 詳細 |
|------|------|
| 予測期間 | 翌営業日〜5営業日先 |
| 予測方式 | 逐次生成（前日の予測値を入力に含めて翌日を予測） |
| 出力形式 | 各日の予測終値 |
| 信頼度指標 | テストデータに対する RMSE（二乗平均平方根誤差） |

### 3.4 チャート表示機能

#### メインチャート

| 項目 | 詳細 |
|------|------|
| チャート種別 | ラインチャート |
| 表示データ | 過去の実際の終値（青線）、予測値（赤線/破線） |
| X軸 | 日付 |
| Y軸 | 株価（円） |
| インタラクション | ツールチップ（ホバーで日付・価格表示） |

#### 補助情報

- 学習進捗バー（エポック数 / 損失値のリアルタイム表示）
- テストデータに対する予測精度（RMSE）
- 予測 vs 実績の比較エリア

### 3.5 ユーザー設定機能

| 設定項目 | 詳細 |
|----------|------|
| ハイパーパラメータ調整 | ウィンドウサイズ、エポック数、学習率、バッチサイズ |
| 予測日数 | 1〜5営業日先 |

---

## 4. 画面構成

### 4.1 画面一覧

```
┌─────────────────────────────────────────────┐
│  ヘッダー: アプリ名 + 説明                     │
├─────────────────────────────────────────────┤
│  設定パネル                                   │
│  ┌─────────────────────────────────────────┐ │
│  │ 証券コード入力 + データ取得ボタン            │ │
│  └─────────────────────────────────────────┘ │
├─────────────────────────────────────────────┤
│  メインチャートエリア                          │
│  ┌─────────────────────────────────────────┐ │
│  │                                         │ │
│  │   過去データ(青) + 予測データ(赤)          │ │
│  │                                         │ │
│  └─────────────────────────────────────────┘ │
├─────────────────────────────────────────────┤
│  コントロールパネル                            │
│  ┌──────────┬──────────┬─────────┬────────┐ │
│  │ウィンドウ  │ エポック  │ 学習率   │バッチ  │ │
│  │サイズ     │ 数       │         │サイズ  │ │
│  └──────────┴──────────┴─────────┴────────┘ │
│  [ 学習開始ボタン ]                           │
├─────────────────────────────────────────────┤
│  学習状況パネル                               │
│  ┌─────────────────────────────────────────┐ │
│  │ プログレスバー | エポック: 25/50          │ │
│  │ 損失: 0.0023   | RMSE: 45.2円           │ │
│  └─────────────────────────────────────────┘ │
├─────────────────────────────────────────────┤
│  予測結果テーブル                              │
│  ┌──────────┬──────────┐                    │
│  │ 日付      │ 予測終値  │                    │
│  │ 2026/2/4 │ ¥3,420   │                    │
│  │ 2026/2/5 │ ¥3,445   │                    │
│  └──────────┴──────────┘                    │
├─────────────────────────────────────────────┤
│  フッター: 免責事項                            │
└─────────────────────────────────────────────┘
```

### 4.2 レスポンシブ対応

| 画面サイズ | レイアウト |
|-----------|----------|
| デスクトップ（1024px以上） | 2カラム（左: サイドバー / 右: メインエリア） |
| タブレット（768px〜1023px） | 1カラム |
| モバイル（767px以下） | 1カラム、コンパクト表示 |

#### デスクトップ 2カラムレイアウト

```
┌──────────────────────────────────────────────────────────┐
│  ヘッダー: アプリ名 + 説明                                  │
├─────────────────┬────────────────────────────────────────┤
│  サイドバー (左)  │  メインエリア (右)                        │
│  幅: 320px 固定   │  幅: 残り全幅                            │
│                  │                                        │
│  ┌────────────┐ │  ┌──────────────────────────────────┐  │
│  │ 証券コード   │ │  │                                  │  │
│  │ +取得ボタン  │ │  │   メインチャート                    │  │
│  └────────────┘ │  │   過去データ(青) + 予測データ(赤)    │  │
│                  │  │                                  │  │
│                  │  └──────────────────────────────────┘  │                                        │
│  ┌────────────┐ │  ┌──────────────────────────────────┐  │
│  │ ハイパー     │ │  │  学習状況パネル                    │  │
│  │ パラメータ   │ │  │  プログレスバー | 損失 | RMSE      │  │
│  │ 調整        │ │  └──────────────────────────────────┘  │
│  └────────────┘ │                                        │
│  ┌────────────┐ │  ┌──────────────────────────────────┐  │
│  │ [学習開始]  │ │  │  予測結果テーブル                   │  │
│  └────────────┘ │  │  日付 | 予測終値                    │  │
│                  │  └──────────────────────────────────┘  │
├─────────────────┴────────────────────────────────────────┤
│  フッター: 免責事項                                        │
└──────────────────────────────────────────────────────────┘
```

#### タブレット・モバイル 1カラムレイアウト

セクション 4.1 の画面構成図と同様、全要素を縦に積む構成とする。モバイルではパラメータ調整パネルをアコーディオン形式で折りたたみ可能にする。

---

## 5. 処理フロー

### 5.1 メインフロー

```
1. ユーザーが証券コードを入力（例: 7203）
3. 「データ取得」ボタン押下
   → Finnhub API から過去1年分の日足データを取得
   → チャートに過去データを表示
4. ハイパーパラメータを調整（任意）
5. 「学習開始」ボタン押下
   → データの前処理（正規化、ウィンドウ作成、分割）
   → LSTM モデルの構築
   → 学習開始（プログレスバー表示）
   → 学習完了後、テストデータで評価
   → 将来の予測値を算出
6. チャートに予測線を追加表示
7. 予測結果テーブルに数値を表示
```

### 5.2 エラーハンドリング

| エラー種別 | 対処 |
|-----------|------|
| 証券コードが存在しない | 「銘柄が見つかりません」表示 |
| データ不足（学習に必要な日数未満） | 「データが不足しています」表示 |
| 学習中のエラー | エラー内容を表示、リトライ可能 |
| ネットワークエラー | 接続状態の確認を促すメッセージ |

---

## 6. 非機能要件

### 6.1 パフォーマンス

| 項目 | 目標値 |
|------|--------|
| データ取得 | 3秒以内 |
| LSTM 学習（50エポック） | 30秒〜2分（端末性能による） |
| 予測計算 | 1秒以内 |
| 初回ページ読み込み | 5秒以内 |

### 6.2 セキュリティ

| 項目 | 対策 |
|------|------|
| データ通信 | Yahoo Finance API は HTTPS で通信（CORSプロキシ経由） |
| XSS 対策 | React の標準エスケープ機能 |

### 6.3 ブラウザ対応

| ブラウザ | 対応状況 |
|---------|---------|
| Chrome（最新） | ○ 推奨 |
| Firefox（最新） | ○ |
| Safari（最新） | ○ |
| Edge（最新） | ○ |
| Internet Explorer | × 非対応 |

---

## 7. 制約事項・注意点

### 7.1 株価予測の限界

- 株価予測は本質的に極めて困難であり、本アプリの予測精度を保証するものではない
- 過去データのパターン学習に基づく予測であり、ファンダメンタルズ分析やニュース等の外部要因は考慮しない
- **本アプリは学習・デモ目的であり、実際の投資判断に利用することは強く非推奨**

### 7.2 Yahoo Finance API の制約

| 制約 | 詳細 |
|------|------|
| 公式サポート | 非公式APIのため、仕様変更で利用不可になる可能性あり |
| レート制限 | 明示的な制限なし（過度なアクセスはIPブロックの可能性） |
| 過去データ | 約1年分（日足） |
| CORS | ブラウザからの直接アクセス不可。allorigins.win プロキシ経由 |
| 日本株カバレッジ | 東証上場銘柄。一部銘柄はデータが取得できない可能性あり |

### 7.3 ブラウザ実行の制約

- 学習速度は端末のGPU/CPU性能に依存する
- 大量データやモデルの複雑化には限界がある
- TensorFlow.js は WebGL バックエンドを使用するため、GPU非搭載端末では遅くなる可能性あり

---

## 8. GitHub Pages デプロイ

### 8.1 ファイル構成

```
/
├── index.html                  # エントリーポイント
├── package.json                # 依存関係・スクリプト定義
├── vite.config.js              # Vite 設定
├── tailwind.config.js          # Tailwind CSS 設定
├── postcss.config.js           # PostCSS 設定
├── src/
│   ├── main.jsx                # React エントリーポイント
│   ├── App.jsx                 # ルートコンポーネント
│   ├── index.css               # グローバルスタイル（Tailwind ディレクティブ）
│   ├── components/
│   │   ├── Header.jsx          # ヘッダー（アプリ名・説明）
│   │   ├── SettingsPanel.jsx   # API キー入力・証券コード検索
│   │   ├── StockChart.jsx      # メインチャート（Recharts）
│   │   ├── ControlPanel.jsx    # ハイパーパラメータ調整
│   │   ├── TrainingStatus.jsx  # 学習進捗表示
│   │   ├── PredictionTable.jsx # 予測結果テーブル
│   │   └── Footer.jsx          # フッター（免責事項）
│   ├── services/
│   │   ├── stockApi.js         # Yahoo Finance API 通信（CORSプロキシ経由）
│   │   └── lstmModel.js        # TensorFlow.js モデル構築・学習・予測
│   └── utils/
│       └── dataProcessing.js   # データ前処理（正規化、ウィンドウ作成等）
├── README.md                   # プロジェクト説明
└── LICENSE                     # ライセンス（MIT）
```

Vite を使用したモジュール分割構成とし、コンポーネント・サービス・ユーティリティを適切に分離する。

### 8.2 デプロイ手順

1. GitHub リポジトリを作成
2. ソースコードをプッシュ
3. `npm run build` でビルド成果物（`dist/`）を生成
4. Settings → Pages → Source: `gh-pages` branch または GitHub Actions でデプロイ
5. 公開 URL が発行される

---

## 9. 今後の拡張案

| 機能 | 概要 |
|------|------|
| 複数銘柄比較 | 複数の銘柄を同時に予測・比較表示 |
| テクニカル指標 | 移動平均線、RSI、MACD 等の表示 |
| モデル保存/読み込み | 学習済みモデルをファイルとしてエクスポート/インポート |
| 特徴量追加 | 終値だけでなく OHLCV 全てを入力特徴量に使用 |
| ローソク足チャート | ラインチャートに加えてローソク足表示 |
| CSV エクスポート | 予測結果のダウンロード |

---

## 10. 免責事項

本アプリケーションは教育・学習目的で開発されたものです。株価の予測結果は一切の正確性を保証するものではなく、投資判断の根拠として使用しないでください。本アプリの使用により生じたいかなる損害についても、開発者は責任を負いません。投資は自己責任で行ってください。
